{"version":3,"sources":["assets\\script\\joystick.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AACM,IAAA,KAAsB,EAAE,CAAC,UAAU,EAAlC,OAAO,aAAA,EAAE,QAAQ,cAAiB,CAAC;AAG1C;IAAsC,4BAAY;IAAlD;QAAA,qEA4DC;QAzDG,WAAK,GAAY,IAAI,CAAC;QAGtB,WAAK,GAAW,GAAG,CAAC;QAGpB,WAAK,GAAW,EAAE,CAAC;QAEZ,SAAG,GAAW,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;;QAgDhC,iBAAiB;IACrB,CAAC;IA/CG,wBAAwB;IAExB,yBAAM,GAAN;QACI,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC;QAEnC,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,UAAU,EAAC,IAAI,CAAC,aAAa,EAAC,IAAI,CAAC,CAAC;QACnE,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,SAAS,EAAC;YACrC,IAAI,CAAC,YAAY,EAAE,CAAC;QACxB,CAAC,EAAC,IAAI,CAAC,CAAC;QAER,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAC;YACxC,IAAI,CAAC,YAAY,EAAE,CAAC;QACxB,CAAC,EAAC,IAAI,CAAC,CAAC;IACZ,CAAC;IAED,oBAAoB;IACpB,gCAAa,GAAb,UAAc,CAAU;QACpB,IAAI,UAAU,GAAW,CAAC,CAAC,WAAW,EAAE,CAAC;QACzC,oBAAoB;QACpB,IAAI,GAAG,GAAW,IAAI,CAAC,IAAI,CAAC,oBAAoB,CAAC,UAAU,CAAC,CAAC;QAC7D,IAAI,GAAG,GAAW,GAAG,CAAC,GAAG,EAAE,CAAC;QAC5B,IAAG,GAAG,IAAI,IAAI,CAAC,KAAK,EAAC;YACjB,OAAO;SACV;QAED,QAAQ;QACR,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;QACzB,IAAI,CAAC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC;QAEzB,IAAG,GAAG,GAAG,IAAI,CAAC,KAAK,EAAC;YAChB,QAAQ;YACR,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;YACjC,GAAG,CAAC,CAAC,GAAG,GAAG,CAAC,CAAC,GAAG,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC;SACpC;QACD,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,GAAG,CAAC,CAAC;IAChC,CAAC;IAED,+BAAY,GAAZ;QACI,IAAI,CAAC,GAAG,GAAG,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC;QACtB,IAAI,CAAC,KAAK,CAAC,WAAW,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,EAAC,CAAC,CAAC,CAAC,CAAC;IACvC,CAAC;IAED,wBAAK,GAAL;IAEA,CAAC;IAtDD;QADC,QAAQ,CAAC,EAAE,CAAC,IAAI,CAAC;2CACI;IAGtB;QADC,QAAQ;2CACW;IAGpB;QADC,QAAQ;2CACU;IATF,QAAQ;QAD5B,OAAO;OACa,QAAQ,CA4D5B;IAAD,eAAC;CA5DD,AA4DC,CA5DqC,EAAE,CAAC,SAAS,GA4DjD;kBA5DoB,QAAQ","file":"","sourceRoot":"/","sourcesContent":["\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class JoyStick extends cc.Component {\r\n\r\n    @property(cc.Node)\r\n    stick: cc.Node = null;\r\n\r\n    @property\r\n    max_R: number = 100;\r\n\r\n    @property\r\n    min_R: number = 20;\r\n\r\n    public dir:cc.Vec2 = cc.v2(0,0);\r\n\r\n    // LIFE-CYCLE CALLBACKS:\r\n\r\n    onLoad () {\r\n        this.stick.setPosition(cc.v2(0,0));\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_MOVE,this.on_stick_move,this);\r\n        this.node.on(cc.Node.EventType.TOUCH_END,function(){\r\n            this.on_stick_end();\r\n        },this);\r\n\r\n        this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(){\r\n            this.on_stick_end();\r\n        },this);\r\n    }\r\n\r\n    // 触摸事件对象,e里面保存了触摸信息\r\n    on_stick_move(e:cc.Touch): void {\r\n        var screen_pos:cc.Vec2 = e.getLocation();\r\n        // 转化坐标系,转化后是手柄内的坐标系\r\n        var pos:cc.Vec2 = this.node.convertToNodeSpaceAR(screen_pos); \r\n        var len: number = pos.mag();\r\n        if(len <= this.min_R){\r\n            return;\r\n        }\r\n\r\n        // 单位化向量\r\n        this.dir.x = pos.x / len;\r\n        this.dir.y = pos.y / len;\r\n\r\n        if(len > this.max_R){\r\n            // 等比例缩放\r\n            pos.x = pos.x * this.max_R / len;\r\n            pos.y = pos.y * this.max_R / len;\r\n        }\r\n        this.stick.setPosition(pos);\r\n    }\r\n\r\n    on_stick_end():void {\r\n        this.dir = cc.v2(0,0);\r\n        this.stick.setPosition(cc.v2(0,0));\r\n    }\r\n\r\n    start () {\r\n\r\n    }\r\n\r\n    // update (dt) {}\r\n}\r\n"]}